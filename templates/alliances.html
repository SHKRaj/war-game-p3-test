{% extends "base.html" %}
{% block title %}Global Alliances | War Command{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/alliances.css') }}">
{% endblock %}

{% block content %}
  <h1>Global Alliances</h1>
  <div id="alliances-list" class="alliances-grid"></div>
  <button onclick="window.location.href='/'" class="back-btn">Return to Command</button>
{% endblock %}

{% block scripts %}
<script>
fetch("/api/alliances")
  .then(res => res.json())
  .then(data => {
    const container = document.getElementById("alliances-list");
    if (data.alliances && data.alliances.length) {
      data.alliances.forEach(a => {
        const card = document.createElement("div");
        card.classList.add("alliance-card");

        const members = a.Members?.length
          ? `<div class="alliance-section"><h3>Members</h3><ul>${a.Members.map(m => `<li>${m}</li>`).join("")}</ul></div>`
          : "";

        const associated = a.Associated?.length
          ? `<div class="alliance-section"><h3>Associated</h3><ul>${a.Associated.map(m => `<li>${m}</li>`).join("")}</ul></div>`
          : "";

        const observers = a.Observers?.length
          ? `<div class="alliance-section"><h3>Observers</h3><ul>${a.Observers.map(m => `<li>${m}</li>`).join("")}</ul></div>`
          : "";

        card.innerHTML = `
          <h2>${a.Name || "Unnamed Alliance"}</h2>
          <p>${a.Desc || "No description provided."}</p>
          ${members || associated || observers
            ? `${members}${associated}${observers}`
            : "<p>No participants listed.</p>"}
        `;

        container.appendChild(card);
      });
    } else {
      container.innerHTML = "<p>No alliances detected.</p>";
    }
  })
  .catch(err => {
    document.getElementById("alliances-list").innerHTML = `<p>Error loading alliances: ${err}</p>`;
  });
</script>
{% endblock %}
